<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Index</title>
</head>

<body>
    <%- include("partials/navbar") %>
        <div>
            <h2>Create a new Post</h2>
            <% if (!locals.user) {%>
                <div>You are not logged in. Please <a href="/sign-in">log in </a>to create a post, and see more details
                    about existing posts!</div>
                <% } else if ((locals.user) && (locals.user.membership_status==="member" )) { %>
                    <div>You are logged in, but your membership has not been approved yet. Please submit your secret
                        code to become an approved member on our <a href="/authorizationLevel">authorization page</a>
                    </div>
                <% } else { %>
                    <form action="/newMessage" method="post">
                        <label for="title">Title</label>
                        <input type="text" id="title" name="title" required>
                        <label for="message">Message</label>
                        <textarea name="message" id="message" rows="5" cols="30"></textarea>
                        <button type="submit">Submit message</button>
                    </form>
            <% } %>
        </div>
        <div>
            <% for (let message of messages) { %>
                <div><%= message.title %></div>
                <div><%= message.full_message %></div>
                <!-- for logged in accounts, but not with basic status, only for approved/admin users -->
                <% if ((locals.user) && (locals.user.membership_status !=="member" )) { %> 
                <div><%= message.timestamp %></div>
                <div><%= message.author_name %></div>
            
                <% } else { %>
                <div>author and date visible to approved users only</div>
                <% } %>
                <% if ((locals.user) && (locals.user.membership_status ==="admin" )) { %> 
                    <form action="/deleteMessage/<%= message.id%>" method="post">
                        <button type="submit" class="deleteButton">Delete message</button>
                    </form>
                <% } %>

            <% } %>
        </div>
    <script>
         
    </script>
</body>

</html>